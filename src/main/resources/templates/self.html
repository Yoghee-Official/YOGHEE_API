<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>KG이니시스 본인인증 테스트</title>
  <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
</head>
<body>
<h1>KG이니시스 본인인증 테스트</h1>
<p>테스트 모드에서는 실제 비용이 청구되지 않습니다.</p>

<button onclick="requestVerification()">본인인증 시작하기</button>

<script th:inline="javascript">
  async function requestVerification() {
    try {
      const response = await PortOne.requestIdentityVerification({
        // 1. 본인의 Store ID 입력
        storeId: "store-0215df32-1674-4210-8157-9efdc55d48b4",

        // 2. 새로 생성한 KG이니시스 채널 키 입력
        channelKey: "channel-key-2f23b3f1-574a-4d57-9765-a805b5ed34cc",

        identityVerificationId: `verification-${crypto.randomUUID()}`,

        // KG이니시스는 보통 통합인증창을 띄우므로 따로 method를 지정하지 않아도 됩니다.
        // 만약 바로 휴대폰 인증을 띄우고 싶다면 method: "PHONE" 추가
      });

      // 인증창 닫힘/실패 처리
      if (response.code != null) {
        console.error(response);
        return alert(`인증 실패: ${response.message}`);
      }

      // 성공 시 백엔드 검증 로직 호출
      console.log("인증 성공 ID:", response.identityVerificationId);

      const validation = await fetch("/auth/verify", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          identityVerificationId: response.identityVerificationId,
        }),
      });

      if (validation.ok) {
        alert("본인인증 및 서버 검증 완료!");
      } else {
        alert("서버 검증 실패");
      }
    } catch (error) {
      console.error(error);
      alert("알 수 없는 에러가 발생했습니다.");
    }
  }
</script>
</body>
</html>